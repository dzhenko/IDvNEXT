<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Aliases.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Aliases.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>43/43</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.18% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>31/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>13/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>47/47</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">64×</span>
<span class="cline-any cline-yes">62×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-yes">60×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">59×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">36×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">34×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-yes">55×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-yes">35×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.4.23;
&nbsp;
import { SafeMath } from './SafeMath.sol';
import { Ownable } from './Ownable.sol';
import { ERC20 } from './ERC20.sol';
&nbsp;
contract Aliases is Ownable {
    using SafeMath for uint;
    
    struct Alias {
        uint claimedOn;
        address owner;
        uint fee;
        bool claimedWithEth;
    }
    
    // Address where funds are collected
    address public wallet;
&nbsp;
    // Address of token collected collected
    address public claimTokenAddress;
    
    // Amount of claim fee in tokens
    uint public claimTokenFeeAmount;
    
    // Amount of claim fee in eth
    uint public claimEthFeeAmount;
    
    // Total amount of claimed aliases
    uint public claimedAliasesCount;
    
    /**
    * Event for claimed aliases count change
    * @param claimedAliasesCount the new count of total claimed aliases
    */
    event ClaimedAliasesCountChanged(uint claimedAliasesCount);
    
    mapping(string =&gt; Alias) private aliasesMap;
    mapping(address =&gt; string[]) private addrAliasesMap;
    
    constructor(address _wallet, address _claimTokenAddress, uint _claimTokenFeeAmount, uint _claimEthFeeAmount) public {
        require(_wallet != address(0));
        require(_claimTokenAddress != address(0));
        
        wallet = _wallet;
        claimTokenAddress = _claimTokenAddress;
        claimTokenFeeAmount = _claimTokenFeeAmount;
        claimEthFeeAmount = _claimEthFeeAmount;
    }
    
    function transferWallet(address _newWallet) public onlyOwner {
        require(_newWallet != address(0));
        wallet = _newWallet;
    }
    
    function changeClaimTokenFeeAmount(uint _newClaimTokenFeeAmount) public onlyOwner {
        claimTokenFeeAmount = _newClaimTokenFeeAmount;
    }
    
    function changeClaimEthFeeAmount(uint _newClaimEthFeeAmount) public onlyOwner {
        claimEthFeeAmount = _newClaimEthFeeAmount;
    }
&nbsp;
    function isClaimedAlias(string _alias) public view returns (bool isClaimed) {
        return aliasesMap[_alias].owner != address(0);
    }
    
    function aliasToAddress(string _alias) public view returns (address addr) {
        return aliasesMap[_alias].owner;
    }
    
    function aliasesCount() public view returns (uint count) {
        return addrAliasesMap[msg.sender].length;
    }
    
    function aliasAtIndex(uint _index) public view returns (string alias) {
        require(addrAliasesMap[msg.sender].length &gt; _index, 'Invalid index.');
        
        string memory savedAlias = addrAliasesMap[msg.sender][_index];
        if (aliasesMap[savedAlias].owner == msg.sender){
            return savedAlias;
        }
        
        return '';
    }
    
    function claimAliasWithEth(string _alias) public payable {
        require(!_isEmptyString(_alias), 'Invalid alias.');
        require(!(isClaimedAlias(_alias)), 'Alias is already claimed.');
        
        if (claimEthFeeAmount &gt; 0) {
            require(msg.value &gt;= claimEthFeeAmount);
            wallet.transfer(claimEthFeeAmount);
            msg.sender.transfer(msg.value.sub(claimEthFeeAmount));
        }
        
        _claimAlias(_alias, true);
    }
    
    function claimAliasWithToken(string _alias) public {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!_isEmptyString(_alias), 'Invalid alias.');
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!(isClaimedAlias(_alias)), 'Alias is already claimed.');
        
        if (claimTokenFeeAmount &gt; 0) {
            //ensure approve() method or this contract will not be able to do the transfer on your behalf.
            require(ERC20(claimTokenAddress).transferFrom(msg.sender, wallet, claimTokenFeeAmount));
        }
        
        _claimAlias(_alias, false);
    }
    
    function releaseAlias(string _alias) public {
        require(!_isEmptyString(_alias), 'Invalid alias.');
        require(isClaimedAlias(_alias), 'Alias not claimed yet.');
        <span class="missing-if-branch" title="else path not taken" >E</span>require(aliasesMap[_alias].owner == msg.sender, 'Alias not yours.');
        
        delete aliasesMap[_alias];
        
        claimedAliasesCount = claimedAliasesCount.sub(1);
        emit ClaimedAliasesCountChanged(claimedAliasesCount);
    }
    
    function _isEmptyString(string _val) private pure returns (bool isEmpty) {
        bytes memory stringBytes = bytes(_val);
        return stringBytes.length == 0;
    }
    
    function _claimAlias(string _alias, bool _claimWithEth) private {
        aliasesMap[_alias].claimedOn = now;
        aliasesMap[_alias].owner = msg.sender;
        
        if (_claimWithEth) {
            aliasesMap[_alias].claimedWithEth = true;
            aliasesMap[_alias].fee = claimEthFeeAmount;
        }
        else{
            aliasesMap[_alias].fee = claimTokenFeeAmount;
        }
        
        addrAliasesMap[msg.sender].push(_alias);
        
        claimedAliasesCount = claimedAliasesCount.add(1);
        emit ClaimedAliasesCountChanged(claimedAliasesCount);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jul 14 2018 13:57:50 GMT+0000 (Coordinated Universal Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
